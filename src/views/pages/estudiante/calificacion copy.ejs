<%- include ../../partials/parte1Superior.ejs %>
<% let valoracion1, valoracion2 %>
<% let informe1, informe2 %>
<% let rowNumber %>

<script src="/js/estudianteAsignatura.ajax.js"></script>

</head>

<body>
<div class="post_msg"></div>
  <!-- ///////////////////////////////////////////////////////7 -->

  <div class="container">
    <h3>Calificaciones</h3>
    <div class="">
      <div>
        <h5> <b><span id="spnCurso"> <%= curso.clave%> </span></b> - 
          <span id="spnAsignatura"> <%= asignatura.asignatura%>
          </span>
          <input id="spnIdAsignatura" value="<%= asignatura.idAsignatura%>" hidden>
            
        </h5>
        <hr>
      </div>
      <div class="">
        <div class="row">
          <a id="periodo1" href="javascript:void(0)" onclick="openCity(event);" aria-disabled="true">
            <div class="w3-quarter tablink w3-bottombar w3-hover-light-grey w3-padding">1° Perído</div>
          </a>
          <a id="periodo2" href="javascript:void(0)" onclick="openCity(event);">
            <div class="w3-quarter tablink w3-bottombar w3-hover-light-grey w3-padding">2° Perído</div>
          </a>
          <a id="periodo3" href="javascript:void(0)" >
            <div class="w3-quarter w3-bottombar w3-hover-light-grey w3-padding w3-opacity">3° Perído</div>
          </a>
          <a id="periodo4" href="javascript:void(0)" >
            <div class="w3-quarter w3-bottombar w3-hover-light-grey w3-padding w3-opacity" >4° Perído</div>
          </a>
        </div>
      </div>
      <table id="estudiantes" class="table table-striped table-bordered nowrap">
        <thead>
          <tr>
            <th rowspan="2" class="col-lg-10">Estudiante</th>
            <th rowspan="2" class="col-lg-2">Dni</th>
            <th colspan="2">1° perído</th>
            <th colspan="2">2° perído</th>
            <th rowspan="2"></th>
          </tr>
          <tr>
            <th>Valoración (1)</th>
            <th>Informe (1)</th>
            <th>Valoración (2)</th>
            <th>Informe (2)</th>
          </tr>
        </thead>
        <tbody class="tbl_user_data">
          
          <% estudiantesPorCurso.forEach(function(estuPorCurso){ %>
            <% rowNumber=''%>
            <% valoracion1='' %>
                  <% informe1='' %>
                  <% for (var l=estudiantesPorCalificaciones.length, i=0; i < l; i++) { %>
                    <% estuPorCalificaciones = estudiantesPorCalificaciones[i]%>
                    <% if( estuPorCurso.estudiante === estuPorCalificaciones.estudiante ){ %>
                      <% valoracion1=estuPorCalificaciones.valoracion1%>
                      <% informe1=estuPorCalificaciones.informe1%>
                      <% rowNumber=estuPorCalificaciones._rowNumber%>
                      <% break %>
                    <% } %>
      
                  <% }; %>
          <tr row_id='<%= estuPorCurso.estudiante%>' rowNumber="<%= rowNumber%>">
            <td>
              <div class="" edit_type="click" col_name="nombre">
                <%= estuPorCurso.estudianteNombre%>
              </div>
            </td>
            <td>
              <div class="" edit_type="click" col_name="nombre">
                <%= estuPorCurso.dni%>
              </div>
            </td>
           
            
            <!-- 1° Informe -->
            <td>

              <select class="row_data form-select" edit_type="click" col_name="valoracion1">
                <option value="" disabled selected></option>
                <% calificacionCodigos.forEach(function(calificacionCodigo){ %>
                  <% if( valoracion1==calificacionCodigo.simbolo ){ %>
                    <option value="<%=calificacionCodigo.simbolo%>" selected>
                      <%=calificacionCodigo.simbolo%> - <%=calificacionCodigo.letra%>
                    </option>
                  <% }else{ %>
                    <option value="<%=calificacionCodigo.simbolo%>">
                      <%=calificacionCodigo.simbolo%> - <%=calificacionCodigo.letra%>
                    </option>
                  <% } %>
                <% }); %>
              </select>
            </td>
            <td class="col-sm-10">
              <textarea  class="row_data form-control" edit_type="click" col_name="informe1" style="width:135px"
                value="<%= informe1%>"/></textarea>
            </td>

            <!-- 2° Informe -->

            <td>
              <select class="row_data form-select" edit_type="click" col_name="valoracion2">
                <option value="" disabled selected></option>
                <% calificacionCodigos.forEach(function(calificacionCodigo){ %>
                  <% if( valoracion2 == calificacionCodigo.simbolo ){ %>
                    <option value="<%=calificacionCodigo.simbolo%>" selected>
                      <%= calificacionCodigo.simbolo %> - <%= calificacionCodigo.letra %>
                    </option>
                  <% } else{ %>
                    <option value="<%=calificacionCodigo.simbolo%>">
                      <%= calificacionCodigo.simbolo %> - <%= calificacionCodigo.letra %>
                    </option>
                  <% } %>
                <% }); %>
              </select>
            </td>
            <td>
              <input class="row_data form-control" edit_type="click" col_name="informe2" style="width:135px"
                value="<%= informe2 %>" autofocus="off" autocorrect="off" autocapitalize="off"/>
            </td>

            <!-- Botones de edición -->
            <td class="w3-padding-0">
              <span class="btn_edit" hidden> 
                <a href="#" class="w3-button w3-white w3-border w3-border-blue" row_id="'+row_id+'">Editar</a> 
              </span>
              <span class="btn_save" >
                <a href="#" class="btn btn-outline-success" row_id="'+row_id+'"> Guardar </a>
              </span>
              <span class="btn_cancel" hidden>
                <a href="#" class="w3-button w3-white w3-border w3-border-red" row_id="'+row_id+'">Cancelar</a>
              </span>
            </td>

          </tr>
          <% }); %>
        </tbody>

      </table>
    </div>

  </div>
  <hr>



  <script type="text/javascript">
    // $(document).ready(function() {
    //   document.getElementsByClassName("tablink")[0].className += " w3-border-black";
    //   $('td:nth-child(4),th:nth-child(4)').hide();
    //         $('td:nth-child(5),th:nth-child(5)').hide();
    //     $('#periodo1').click(function() {
    //         $('td:nth-child(2),th:nth-child(2)').show();
    //         $('td:nth-child(3),th:nth-child(3)').show();
    //         $('td:nth-child(4),th:nth-child(4)').hide();
    //         $('td:nth-child(5),th:nth-child(5)').hide();
    //     });
    //     $('#periodo2').click(function() {
    //         $('td:nth-child(4),th:nth-child(4)').show();
    //         $('td:nth-child(5),th:nth-child(5)').show();
    //         $('td:nth-child(2),th:nth-child(2)').hide();
    //         $('td:nth-child(3),th:nth-child(3)').hide();
    //     });
    // });

    $(document).ready(function() {
    var table = $('#estudiantes').DataTable( {
        responsive: true
    } );
 
    new $.fn.dataTable.FixedHeader( table );
} );  
</script>

<script>
function openCity(evt, cityName) {
  var i, tablinks;

  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" w3-border-black", "");
  }
  evt.currentTarget.firstElementChild.className += " w3-border-black";
}
  </script>
<%- include ../../partials/parte2Inferior.ejs %>